# 正确的配置该死的环境（后篇）

在week1中，大家也许已经看到了教授利用了cs50自己的工具论，比如string等函数，再次我们欢迎大家自己同时可以在自己的环境里也配置上

## c编译器运行原理
### 1. 预处理阶段
```c
#include <cs50.h>  
#define PI 3.14    
```
这个阶段就是处理所有的`#`开头的指令，把该包含的文件内容都复制过来，该替换的宏都替换掉。

### 2. 编译阶段
现在编译器开始把C代码"翻译"成汇编语言。就像你把中文句子逐句转成英文，同时检查语法对不对：
```c
int x = get_int(); // → 变成汇编指令
```
### 3.机器码
把汇编代码转成二进制的机器码，生成`.o`目标文件。这就好比把英文转成摩斯密码，只有机器能直接理解。

### 4. 链接
把你写的代码和CS50库这样的第三方库链接在一起，生成最终的可执行文件。就像你把各个章节拼成一本完整的书。



## 静态库和动态库
库是写好的现有的成熟的可以复用的代码。
库有两种：静态库（.a.lib）动态库（.so.dll）
动态和静态指的则是链接


## 实操
基于上面所讲，我们可以很轻松的配置第三方库例如cs50

进入vscode工作区，例如你刚刚的c文件夹
```
cd c
```
进入该文件夹，并且克隆cs50库的源代码。
```
git clone https://github.com/cs50/libcs50.git
```
进入刚刚下载的 libcs5 目录。
```
cd libcs50
```
 执行 make 命令来编译整个库

于是.....
![](/images/Pasted-image-20251125214108.png)

冷静，报错显示无法使用cut命令
根据我们上一个文档的知识，我们已经知道make命令是可以正常运行的，运行make的前提之一是配置了msy2的mingw64的make的环境变量，第二是由makefile指引。

那么问题很明显是cs50官方的库的makefile是有问题的（至少不一定适配windows环境）
![](/images/Pasted-image-20251125214609.png)
果然点开，发现只有mac和linux的（即使看不懂也有注释）

没关系，那我们可以自己写一个
```c
# Windows Makefile for cs50 library (use with: mingw32-make -f Makefile.win)

CC = gcc
CFLAGS = -Wall -Wextra -Werror -pedantic -std=c11

SRC = src/cs50.c
INCLUDE = src/cs50.h
OBJ = cs50.o
LIB = libcs50.a

all: $(LIB)

$(LIB): $(OBJ)
	ar rcs $(LIB) $(OBJ)
	del $(OBJ)
	@echo.
	@echo Build complete! Created $(LIB)
	@echo.
	@echo To use in your project:
	@echo   gcc your_program.c -I. -L. -lcs50 -o your_program

$(OBJ): $(SRC) $(INCLUDE)
	$(CC) $(CFLAGS) -c $(SRC) -o $(OBJ)

clean:
	if exist $(LIB) del $(LIB)
	if exist $(OBJ) del $(OBJ)

.PHONY: all clean

```
在libcs50文件创建文件Makefile.win，输入命令make -f Makefile.win
编译完成后会生成 libcs50.a 静态库。


现在我们已经有了类似stido.h的头文件cs50.h，在cs50的本来的文件夹里，同时我们也自己编译了libcs50.a完整的静态库

找到MinGW系统目录，将cs50.h复制到mingw64的include文件夹，同时将libcs50.a复制到mingw64的lib文件夹

之后我们任意项目的makefile只需要
```makefile
CC = gcc
CFLAGS = -Wall -std=c11
LDFLAGS = -L./libcs50 -lcs50

%: %.c
	$(CC) $(CFLAGS) $< $(LDFLAGS) -o $@


```

我们便可以直接使用cs50库里的函数，以及使用make命令进行编译等操作

![](/images/Pasted-image-20251126090226.png)

对于头文件，vscode已经没有报错了

接下来我们使用make编译此文件
![](/images/Pasted-image-20251126090545.png)

成功执行，并且可以看到资源管理器已经有一个test.exe文件
我们直接运行
![](/images/Pasted-image-20251126090924.png)

成功。


> 除了我们将编译好后的静态库文件放在mingw64，我们也可以将原生的cs50.c以及cs50.h直接放在项目文件夹，接下来进行的操作我想聪明的你应该也会知道吧（）
> 欢迎评论区进行讨论

<Giscus />
